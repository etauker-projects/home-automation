- id: '1689283863346'
  alias: Toggle Blinds
  description: Close blinds if they're open, otherwise fully open them.
  trigger:
  - platform: device
    domain: mqtt
    device_id: 2e4d7d3bd473ef60f33ca92bc4662f53
    type: click
    subtype: single
    discovery_id: 0x00158d00087427a6 click_single
    enabled: false
  condition: []
  action:
  - service: script.update_device_status
    data: {}
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - if:
    - condition: device
      device_id: bee20f914aa1b980f607bf04854727ae
      domain: cover
      entity_id: cover.blinds_001
      type: is_position
      below: 100
    then:
    - device_id: bee20f914aa1b980f607bf04854727ae
      domain: cover
      entity_id: cover.blinds_001
      type: set_position
      position: 100
    else:
    - device_id: bee20f914aa1b980f607bf04854727ae
      domain: cover
      entity_id: cover.blinds_001
      type: set_position
      position: 0
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
    enabled: true
  - service: script.update_device_status
    data: {}
  - service: logbook.log
    data:
      entity_id: cover.blinds_001
      message: status update
      name: '{{entity_id}}'
  mode: single
- id: '1689295153626'
  alias: Change sleep mode to "wake"
  description: ''
  trigger:
  - platform: time
    at: 08:30:00
    enabled: false
  - platform: time
    at: sensor.sm_g973f_next_alarm
  condition: []
  action:
  - service: input_select.select_option
    data:
      option: wake
    target:
      entity_id: input_select.sleep_mode
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: input_select.select_option
    data:
      option: 'off'
    target:
      entity_id: input_select.sleep_mode
  mode: single
- id: '1689553261485'
  alias: Toggle Bedroom LEDs
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 2e4d7d3bd473ef60f33ca92bc4662f53
    type: click
    subtype: single
    discovery_id: 0x00158d00087427a6 click_single
    enabled: false
  condition: []
  action:
  - if:
    - condition: device
      device_id: bee20f914aa1b980f607bf04854727ae
      domain: cover
      entity_id: cover.blinds_001
      type: is_position
      below: 100
    then:
    - device_id: bee20f914aa1b980f607bf04854727ae
      domain: cover
      entity_id: cover.blinds_001
      type: set_position
      position: 100
    else:
    - device_id: bee20f914aa1b980f607bf04854727ae
      domain: cover
      entity_id: cover.blinds_001
      type: set_position
      position: 0
    enabled: false
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
    enabled: false
  - service: remote.send_command
    data:
      device: light_remote_001
      command: 'on'
    target:
      entity_id: remote.remote_001
  - service: logbook.log
    data:
      entity_id: cover.blinds_001
      message: status update
      name: '{{entity_id}}'
    enabled: false
  mode: single
- id: '1697582815027'
  alias: Sleep mode changed to "wake"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_select.sleep_mode
    from: sleep
    to: wake
  condition: []
  action:
  - if:
    - condition: sun
      before: sunrise
    then:
    - type: turn_on
      device_id: 474122319d1e56391ad01e5c81c7b2d8
      entity_id: 33dc613da234bcb207daa2af15983438
      domain: light
      brightness_pct: 50
      flash: short
      enabled: false
    - service: script.turn_bedside_light_on
      data: {}
  - device_id: bee20f914aa1b980f607bf04854727ae
    domain: cover
    entity_id: f340d584f4a05c55ccf48ddcb806611e
    type: open
  - wait_for_trigger:
    - platform: state
      entity_id:
      - cover.blinds_001
      to: open
    timeout:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - service: script.update_device_status
    data: {}
  mode: single
- id: '1697583290030'
  alias: Change sleep mode with button click
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 2e4d7d3bd473ef60f33ca92bc4662f53
    type: action
    subtype: double
    discovery_id: 0x00158d00087427a6 action_double
  condition: []
  action:
  - service: input_select.select_next
    data:
      cycle: true
    target:
      entity_id: input_select.sleep_mode
  - service: logbook.log
    data: {}
    enabled: false
  mode: single
- id: '1697583486417'
  alias: Sleep mode changed to "sleep"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_select.sleep_mode
    to: sleep
  condition: []
  action:
  - type: turn_off
    device_id: 474122319d1e56391ad01e5c81c7b2d8
    entity_id: 33dc613da234bcb207daa2af15983438
    domain: light
  - device_id: bee20f914aa1b980f607bf04854727ae
    domain: cover
    entity_id: f340d584f4a05c55ccf48ddcb806611e
    type: close
  - wait_for_trigger:
    - platform: state
      entity_id:
      - cover.blinds_001
      to: closed
    timeout:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - service: script.update_device_status
    data: {}
  mode: single
- id: '1697586437877'
  alias: Sleep mode changed to "off"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_select.sleep_mode
    to: 'off'
    from: wake
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
    enabled: false
  - type: turn_off
    device_id: 474122319d1e56391ad01e5c81c7b2d8
    entity_id: 33dc613da234bcb207daa2af15983438
    domain: light
  mode: single
- id: '1697672334213'
  alias: Toggle bedside light on button click
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 2e4d7d3bd473ef60f33ca92bc4662f53
    type: action
    subtype: single
    discovery_id: 0x00158d00087427a6 action_single
  condition: []
  action:
  - choose:
    - conditions:
      - condition: device
        type: is_off
        device_id: 474122319d1e56391ad01e5c81c7b2d8
        entity_id: 33dc613da234bcb207daa2af15983438
        domain: light
      sequence:
      - type: turn_on
        device_id: 474122319d1e56391ad01e5c81c7b2d8
        entity_id: 33dc613da234bcb207daa2af15983438
        domain: light
        brightness_pct: 50
        flash: long
        enabled: false
      - service: script.turn_bedside_light_on
        data: {}
  - choose:
    - conditions:
      - condition: device
        type: is_on
        device_id: 474122319d1e56391ad01e5c81c7b2d8
        entity_id: 33dc613da234bcb207daa2af15983438
        domain: light
      sequence:
      - type: turn_off
        device_id: 474122319d1e56391ad01e5c81c7b2d8
        entity_id: 33dc613da234bcb207daa2af15983438
        domain: light
  mode: single
- id: '1697672674705'
  alias: Sleep mode changed to "bedtime"
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_select.sleep_mode
    to: bedtime
  condition: []
  action:
  - service: script.turn_bedside_light_on
    data: {}
  - type: turn_on
    device_id: 474122319d1e56391ad01e5c81c7b2d8
    entity_id: 33dc613da234bcb207daa2af15983438
    domain: light
    flash: long
    brightness_pct: 50
    enabled: false
  - type: turn_on
    device_id: 474122319d1e56391ad01e5c81c7b2d8
    entity_id: 33dc613da234bcb207daa2af15983438
    domain: light
    flash: long
    brightness_pct: 50
    enabled: false
  - device_id: bee20f914aa1b980f607bf04854727ae
    domain: cover
    entity_id: f340d584f4a05c55ccf48ddcb806611e
    type: close
  - service: script.update_device_status
    data: {}
  mode: single
- id: '1697844748343'
  alias: Set previous cube angle
  description: ''
  trigger:
  - type: value
    platform: device
    device_id: d19a9bac503705f27905fe960f19e95d
    entity_id: da14357743efaa9d1a3b8c3c7fed219d
    domain: sensor
    above: -360
    below: 360
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.cube_001_action_angle
      state: unavailable
    - condition: state
      entity_id: sensor.cube_001_action_angle
      state: unknown
  action:
  - service: input_number.set_value
    data:
      value: "{% if has_value('sensor.cube_001_action_angle') and not is_state('sensor.cube_001_action_angle',
        'unknown') %}\n  {% set new_angle = states('sensor.cube_001_action_angle')
        %}\n{% else %}\n  {% set new_angle = \"0\" %}\n{% endif %}\n{% set val = int(states.input_number.previous_cube_angle.state)
        + int(new_angle) %}\n{% if val > 254 %}\n  {% set val = 254 %}\n{% endif %}\n{%
        if val < 0 %}\n  {% set val = 0 %}\n{% endif %}\n{{ val }}\n"
    target:
      entity_id: input_number.previous_cube_angle
  mode: single
- id: '1697892954166'
  alias: Set cube selected side
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.cube_001_side
    from:
    to:
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.cube_001_action_side
      state: unavailable
    - condition: state
      entity_id: sensor.cube_001_action_side
      state: unknown
    - condition: state
      entity_id: sensor.cube_001_action_side
      state: None
    enabled: false
  - condition: template
    value_template: '{{ is_number(states.sensor.cube_001_side.state) }}'
  action:
  - service: logbook.log
    data:
      entity_id: sensor.cube_001_side
      name: Old cube side
      message: '{{ states.input_select.cube_selected_side.state }} (should be set
        to: {{ states.sensor.cube_001_side.state }})'
  - service: input_number.set_value
    data:
      value: '{{ states.sensor.cube_001_side.state }}'
    target:
      entity_id: input_select.cube_selected_side
  - service: logbook.log
    data:
      entity_id: sensor.cube_001_side
      name: New cube side
      message: '{{ states.input_select.cube_selected_side.state }} (should be set
        to: {{ states.sensor.cube_001_side.state }})'
  mode: single
- id: '1697906604684'
  alias: Trigger Script on cube side change
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.cube_001_side
  condition: []
  action:
  - service: script.set_sitting_room_floor_light_colour
    data: {}
  mode: single
- id: '1697908306861'
  alias: Set floor lamp brightness
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_number.previous_cube_angle
  condition: []
  action:
  - service: script.set_sitting_room_floor_light_brightness
    data: {}
  mode: single
